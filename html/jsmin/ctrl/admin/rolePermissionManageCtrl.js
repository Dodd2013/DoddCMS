"use strict";define(["angular","pnotify"],function(e,t){t.prototype.options.styling="bootstrap3";var i="rolePermissionManageCtrl";return{route:{path:"rolePermissionManage",route:{url:"/rolePermissionManage",templateUrl:"tpls/rolePermissionManage.html",controller:i,params:{role:{}}}},ctrl:{name:i,fn:["$scope","$state","$stateParams","$http",function(e,i,o,a){function n(e,t,i){if(null==e)return"未知时间";var o=new Date(e),a=o.toLocaleString();return a}function r(t,i,o){var a="",n="";return e.deleteRolePermission&&(n="<a data-op='delete' data-DESC='"+i.DESC+"' data-permissionId='"+i.permissionId+"' class='opBtn' title='删除用户角色'><span class='glyphicon glyphicon-trash'></span></a>"),a+n}var l=o.role;l.roleName?e.role=l:e.role=!1,e.premission=null,e.canAddRolePermission=!0,e.deleteRolePermissionBtn=!1,e.ajaxRequest=function(t){var i=a({url:config.api+"/rolePermission",method:"GET",withCredentials:!0,params:{params:t.data,roleId:e.role.roleId}});a({url:config.api+"/getPermission",method:"GET",withCredentials:!0}).then(function(t){e.permissionList=t.data});null===e.premission?a({url:config.api+"/getPermission",method:"GET",withCredentials:!0,params:{functionModel:301}}).then(function(t){e.premission=t.data;var o=!0,a=!1,n=void 0;try{for(var r,l=e.premission[Symbol.iterator]();!(o=(r=l.next()).done);o=!0){var s=r.value;"addRolePermission"===s.permissionName&&(e.canAddRolePermission=!1),"deleteRolePermission"===s.permissionName&&(e.deleteRolePermission=!0)}}catch(d){a=!0,n=d}finally{try{!o&&l["return"]&&l["return"]()}finally{if(a)throw n}}return i}).then(function(e){t.success(e.data)}):i.then(function(e){t.success(e.data)})},e.tableCtrl={options:{toolbar:"#toolbar",ajax:e.ajaxRequest,rowStyle:function(e,t){return{classes:"none"}},sidePagination:"client",cache:!1,height:500,striped:!0,pagination:!0,pageSize:10,pageList:[5,10,25,50,100,200],search:!0,showColumns:!0,showRefresh:!0,minimumCountColumns:2,clickToSelect:!1,maintainSelected:!0,columns:[{field:"permissionId",title:"权限ID",align:"center",valign:"bottom",sortable:!0},{field:"actionUrl",title:"API地址",align:"center",valign:"middle"},{field:"method",title:"方法",align:"center",valign:"middle"},{field:"permissionName",title:"权限名",align:"center",valign:"middle"},{field:"DESC",title:"描述",align:"center",valign:"middle"},{field:"createdAt",title:"创建时间",align:"center",valign:"middle",formatter:n,sortable:!0},{field:"updatedAt",title:"更新时间",align:"center",valign:"middle",formatter:n,sortable:!0},{field:"op",title:"操作",align:"center",valign:"middle",clickToSelect:!1,formatter:r}]}},e.addOrEdit="add",$("#RolePermissionTable").on("click",".opBtn",function(t){var i=$(t.target).parent().attr("data-op"),o={permissionId:$(t.target).parent().attr("data-permissionId"),DESC:$(t.target).parent().attr("data-DESC")};"delete"===i&&e.$apply(function(){e.showRemove(o)})}),e.showAdd=function(){e.addOrEdit="add",$("#addAndEditModal").modal("show")},e.showRemove=function(t){e.permissionId=t.permissionId,$("#deleteModal").modal("show")},e.deleteRolePermissionBtn=function(){a({url:config.api+"/rolePermission/delete",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:$.param,data:{roleId:e.role.roleId,permissionId:e.permissionId}}).then(function(i){"ok"===i.data.status&&(new t({type:"danger",text:"删除成功"}),e.roleId=e.roleName=e.DESC="",$("#deleteModal").modal("hide"),$("#RolePermissionTable").bootstrapTable("refresh")),"no"===i.data.status&&(new t({type:"danger",text:"删除失败！"}),e.roleId=e.roleName=e.DESC="",$("#deleteModal").modal("hide"),$("#RolePermissionTable").bootstrapTable("refresh"))})},e.datax={},e.addAndEditRoleBtn=function(){"add"==e.addOrEdit&&a({url:config.api+"/rolePermission/add",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:$.param,data:{permissionId:e.datax.selectRole.permissionId,roleId:e.role.roleId}}).then(function(i){new t({type:"info",text:"添加成功"}),e.roleId=e.roleName=e.DESC="",$("#addAndEditModal").modal("hide"),$("#RolePermissionTable").bootstrapTable("refresh")},function(e){new t({type:"error",text:"添加失败"})})}}]}}});