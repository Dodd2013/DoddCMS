"use strict";define(["require","angular","ueditor","jquery","zeroclipboard","config","pnotify"],function(e,t,n,o,r,i,l){l.prototype.options.styling="bootstrap3";var a="publishCtrl";return i=i.config,{route:{path:"publish",route:{url:"/publish",templateUrl:"tpls/publish.html",controller:a,params:{contentId:null}}},ctrl:{name:a,fn:["$scope","$http","$stateParams",function(e,n,a){var c=a.contentId;window.ZeroClipboard=r,window.UE.delEditor("container"),e.editor=window.UE.getEditor("container"),e.editor.ready(function(){c&&n({url:i.api+"/content/getById",method:"GET",withCredentials:!0,params:{contentId:c}}).then(function(t){e.content=t.data,e.editor.setContent(e.content.contentWithHTML)})}),e.selectColumnInput=function(){o("#seletColumnModal").modal("show")},e.selectColumnClick=function(){e.belongtoColumn=e.selected.text,e.belongtoColumnId=e.selected.id,o("#seletColumnModal").modal("hide")},e.publish=function(){n({url:i.api+"/content/add",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:o.param,data:{source:e.source,sourceUrl:e.sourceUrl,contentTitle:e.contentTitle,simpleTitle:e.simpleTitle,columnId:e.belongtoColumnId,contentDESC:e.contentDESC,contentType:"default",contentWithHTML:e.editor.getContent(),contentText:e.editor.getContentTxt()}}).then(function(e){new l("OK"===e.statusText?{type:"success",text:"发布文章成功!"}:{type:"error",text:"发布文章失败!"})},function(e){new l({type:"error",text:"发布文章失败!"})})},e.initJsTree=function(){n({url:i.api+"/column",method:"GET",withCredentials:!0}).then(function(t){e.originalData=t.data,e.reCreateTree()})},e.selectColumn=function(t,n,o){for(var r in e.originalData)if(e.originalData[r].id===n.selected[0]){e.selected=e.originalData[r];break}},e.treeEventsObj={select_node:e.selectColumn},e.ignoreChanges=!1,e.treeInstance={},e.originalData=[],e.treeData=[],t.copy(e.originalData,e.treeData),e.treeConfig={core:{multiple:!1,animation:!0,error:function(e){$log.error("treeCtrl: error from js tree - "+t.toJson(e))},check_callback:!0,worker:!0},types:{"default":{icon:"glyphicon glyphicon-th"},root:{icon:"glyphicon glyphicon-th-large"}},version:1,plugins:["types","contextmenu"]},e.reCreateTree=function(){e.ignoreChanges=!0,t.copy(e.originalData,e.treeData),e.treeConfig.version++},e.applyModelChanges=function(){return!e.ignoreChanges},e.initJsTree()}]}}});