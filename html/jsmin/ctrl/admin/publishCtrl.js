"use strict";define(["require","angular","ueditor","jquery","zeroclipboard","config","pnotify"],function(t,e,n,o,r,i,c){c.prototype.options.styling="bootstrap3";var l="publishCtrl";return i=i.config,{route:{path:"publish",route:{url:"/publish",templateUrl:"tpls/publish.html",controller:l,params:{contentId:null}}},ctrl:{name:l,fn:["$scope","$http","$stateParams",function(t,n,l){var a=l.contentId;window.ZeroClipboard=r,window.UE.delEditor("container"),t.isEdit=!1,t.editor=window.UE.getEditor("container"),t.editor.ready(function(){a&&(t.isEdit=!0,n({url:i.api+"/content/getById",method:"GET",withCredentials:!0,params:{contentId:a}}).then(function(e){t.content=e.data,t.contentTitle=t.content.contentTitle,t.simpleTitle=t.content.simpleTitle,t.contentDESC=t.content.contentDESC,t.source=t.content.source,t.sourceUrl=t.content.sourceUrl,t.editor.setContent(t.content.contentWithHTML)}))}),t.selectColumnInput=function(){o("#seletColumnModal").modal("show")},t.selectColumnClick=function(){t.belongtoColumn=t.selected.text,t.belongtoColumnId=t.selected.id,o("#seletColumnModal").modal("hide")},t.publish=function(){t.isEdit?n({url:i.api+"/content/update",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:o.param,data:{contentId:t.content.contentId,source:t.source,sourceUrl:t.sourceUrl,contentTitle:t.contentTitle,simpleTitle:t.simpleTitle,contentDESC:t.contentDESC,contentType:"default",contentWithHTML:t.editor.getContent(),contentText:t.editor.getContentTxt()}}).then(function(t){new c("OK"===t.statusText?{type:"success",text:"修改文章成功!"}:{type:"error",text:"修改文章失败!"})},function(t){new c({type:"error",text:"修改文章失败!"})}):n({url:i.api+"/content/add",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:o.param,data:{source:t.source,sourceUrl:t.sourceUrl,contentTitle:t.contentTitle,simpleTitle:t.simpleTitle,columnId:t.belongtoColumnId,contentDESC:t.contentDESC,contentType:"default",contentWithHTML:t.editor.getContent(),contentText:t.editor.getContentTxt()}}).then(function(t){new c("OK"===t.statusText?{type:"success",text:"发布文章成功!"}:{type:"error",text:"发布文章失败!"})},function(t){new c({type:"error",text:"发布文章失败!"})})},t.initJsTree=function(){n({url:i.api+"/column",method:"GET",withCredentials:!0}).then(function(e){t.originalData=e.data,t.reCreateTree()})},t.selectColumn=function(e,n,o){for(var r in t.originalData)if(t.originalData[r].id===n.selected[0]){t.selected=t.originalData[r];break}},t.treeEventsObj={select_node:t.selectColumn},t.ignoreChanges=!1,t.treeInstance={},t.originalData=[],t.treeData=[],e.copy(t.originalData,t.treeData),t.treeConfig={core:{multiple:!1,animation:!0,error:function(t){$log.error("treeCtrl: error from js tree - "+e.toJson(t))},check_callback:!0,worker:!0},types:{"default":{icon:"glyphicon glyphicon-th"},root:{icon:"glyphicon glyphicon-th-large"}},version:1,plugins:["types","contextmenu"]},t.reCreateTree=function(){t.ignoreChanges=!0,e.copy(t.originalData,t.treeData),t.treeConfig.version++},t.applyModelChanges=function(){return!t.ignoreChanges},t.initJsTree()}]}}});