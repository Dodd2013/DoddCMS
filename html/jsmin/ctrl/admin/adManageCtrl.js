"use strict";define(["angular","bootstrapTableNg","bootstrapTableCN","config","pnotify","jquery"],function(a){var d=require("config").config,e=require("jquery"),t=require("pnotify");t.prototype.options.styling="bootstrap3";var r="adManageCtrl";return{route:{path:"adManage",route:{url:"/adManage",templateUrl:"tpls/adManage.html",controller:r}},ctrl:{name:r,fn:["$scope","$http",function(a,r){function n(a,d,e){if(null==a)return"未知时间";var t=new Date(a),r=t.toLocaleString();return r}function o(d,e,t){var r="",n="";return a.editAd&&(r="<a data-op='edit' data-orderby='"+e.orderby+"' data-adPos='"+e.adPos+"' data-adData='"+e.adData+"' data-adUrl='"+e.adUrl+"' data-adName='"+e.adName+"' data-adId='"+e.adId+"' class='opBtn' title='编辑广告位'><span class='glyphicon glyphicon-edit'></span></a>"),a.deleteAd&&(n="<a data-op='delete' data-orderby='"+e.orderby+"' data-adPos='"+e.adPos+"' data-adData='"+e.adData+"' data-adUrl='"+e.adUrl+"' data-adName='"+e.adName+"' data-adId='"+e.adId+"' class='opBtn' title='删除广告位'><span class='glyphicon glyphicon-trash'></span></a>"),r+n}a.premission=null,a.canAddNav=!0,a.editAd=a.deleteNavBtn=!1,a.ajaxRequest=function(e){var t=r({url:d.api+"/ad",method:"GET",withCredentials:!0,params:e.data});null===a.premission?r({url:d.api+"/getPermission",method:"GET",withCredentials:!0,params:{functionModel:202}}).then(function(d){a.premission=d.data;var e=!0,r=!1,n=void 0;try{for(var o,i=a.premission[Symbol.iterator]();!(e=(o=i.next()).done);e=!0){var l=o.value;"addAd"===l.permissionName&&(a.canAddNav=!1),"editAd"===l.permissionName&&(a.editAd=!0),"deleteAd"===l.permissionName&&(a.deleteAd=!0)}}catch(s){r=!0,n=s}finally{try{!e&&i["return"]&&i["return"]()}finally{if(r)throw n}}return t}).then(function(a){e.success(a.data)}):t.then(function(a){e.success(a.data)})},a.tableCtrl={options:{toolbar:"#toolbar",ajax:a.ajaxRequest,rowStyle:function(a,d){return{classes:"none"}},sidePagination:"server",cache:!1,height:500,striped:!0,pagination:!0,pageSize:10,pageList:[5,10,25,50,100,200],search:!0,showColumns:!0,showRefresh:!0,minimumCountColumns:2,clickToSelect:!1,maintainSelected:!0,columns:[{field:"adId",title:"广告位ID",align:"center",valign:"bottom",sortable:!0},{field:"adName",title:"广告位名称",align:"center",valign:"middle"},{field:"adUrl",title:"广告位连接",align:"center",valign:"middle"},{field:"adPos",title:"广告位位置",align:"center",valign:"middle"},{field:"adData",title:"广告位数据",align:"center",valign:"middle"},{field:"orderby",title:"优先级",align:"center",valign:"middle",sortable:!0},{field:"createdAt",title:"创建时间",align:"center",valign:"middle",formatter:n,sortable:!0},{field:"updatedAt",title:"更新时间",align:"center",valign:"middle",formatter:n,sortable:!0},{field:"op",title:"操作",align:"center",valign:"middle",clickToSelect:!1,formatter:o}]}},a.addOrEdit="add",e("#adTable").on("click",".opBtn",function(d){var t=e(d.currentTarget).attr("data-op"),r={adId:e(d.currentTarget).attr("data-adId"),adPos:e(d.currentTarget).attr("data-adPos"),adData:e(d.currentTarget).attr("data-adData"),adName:e(d.currentTarget).attr("data-adName"),adUrl:e(d.currentTarget).attr("data-adUrl"),orderby:parseInt(e(d.currentTarget).attr("data-orderby"))};"edit"===t?a.$apply(function(){a.showEdit(r)}):"delete"===t&&a.$apply(function(){a.showRemove(r)})}),a.showAdd=function(){a.addOrEdit="add",e("#addAndEditModal").modal("show")},a.showEdit=function(d){a.adId=d.adId,a.addOrEdit="edit",a.adName=d.adName,a.adUrl=d.adUrl,a.adPos=d.adPos,a.adData=d.adData,a.adOrderBy=d.orderby,e("#addAndEditModal").modal("show")},a.showRemove=function(d){a.adId=d.adId,e("#deleteModal").modal("show")},a.deleteNavBtn=function(){r({url:d.api+"/ad/delete",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:e.param,data:{adId:a.adId}}).then(function(d){"ok"===d.data.status?(new t({type:"danger",text:"删除成功"}),a.adId=a.adName=a.adUrl=a.adPos=a.adData=a.adOrderBy="",e("#deleteModal").modal("hide"),e("#adTable").bootstrapTable("refresh")):(new t({type:"danger",text:"删除失败"}),a.adId=a.adName=a.adUrl=a.adPos=a.adData=a.adOrderBy="",e("#deleteModal").modal("hide"),e("#adTable").bootstrapTable("refresh"))})},a.addAndEditNavBtn=function(){"edit"==a.addOrEdit?r({url:d.api+"/ad/edit",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:e.param,data:{adId:a.adId,adPos:a.adPos,adData:a.adData,adName:a.adName,adUrl:a.adUrl,orderby:a.adOrderBy}}).then(function(d){new t({type:"info",text:"修改成功"}),a.adId=a.adName=a.adUrl=a.adPos=a.adData=a.adOrderBy="",e("#addAndEditModal").modal("hide"),e("#adTable").bootstrapTable("refresh")},function(a){new t({type:"error",text:"修改失败"})}):"add"==a.addOrEdit&&r({url:d.api+"/ad/add",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:e.param,data:{adName:a.adName,adPos:a.adPos,adData:a.adData,adUrl:a.adUrl,orderby:a.adOrderBy}}).then(function(d){new t({type:"info",text:"添加成功"}),a.adId=a.adName=a.adUrl=a.adPos=a.adData=a.adOrderBy="",e("#addAndEditModal").modal("hide"),e("#adTable").bootstrapTable("refresh")},function(a){new t({type:"error",text:"添加失败"})})}}]}}});