"use strict";define(["angular","bootstrapTableNg","bootstrapTableCN","config","pnotify","jquery"],function(e){var a="navManageCtrl",t=require("config").config,n=require("jquery"),r=require("pnotify");return r.prototype.options.styling="bootstrap3",{route:{path:"navManage",route:{url:"/navManage",templateUrl:"tpls/navManage.html",controller:a}},ctrl:{name:a,fn:["$scope","$http",function(e,a){function d(e,a,t){if(null==e)return"未知时间";var n=new Date(e),r=n.toLocaleString();return r}function i(a,t,n){var r="",d="";return e.editNavBar&&(r="<a data-op='edit' data-orderby='"+t.orderby+"' data-url='"+t.url+"' data-itemName='"+t.itemName+"' data-itemId='"+t.itemId+"' class='opBtn' title='编辑导航'><span class='glyphicon glyphicon-edit'></span></a>"),e.deleteNavBar&&(d="<a data-op='delete' data-orderby='"+t.orderby+"' data-url='"+t.url+"' data-itemName='"+t.itemName+"' data-itemId='"+t.itemId+"' class='opBtn' title='删除导航'><span class='glyphicon glyphicon-trash'></span></a>"),r+d}e.premission=null,e.canAddNav=!0,e.editNavBar=e.deleteNavBtn=!1,e.ajaxRequest=function(n){var r=a({url:t.api+"/navbar",method:"GET",withCredentials:!0,params:n.data});null===e.premission?a({url:t.api+"/getPermission",method:"GET",withCredentials:!0,params:{functionModel:201}}).then(function(a){e.premission=a.data;var t=!0,n=!1,d=void 0;try{for(var i,o=e.premission[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var l=i.value;"addNavBar"===l.permissionName&&(e.canAddNav=!1),"editNavBar"===l.permissionName&&(e.editNavBar=!0),"deleteNavBar"===l.permissionName&&(e.deleteNavBar=!0)}}catch(s){n=!0,d=s}finally{try{!t&&o["return"]&&o["return"]()}finally{if(n)throw d}}return r}).then(function(e){n.success(e.data)}):r.then(function(e){n.success(e.data)})},e.tableCtrl={options:{toolbar:"#toolbar",ajax:e.ajaxRequest,rowStyle:function(e,a){return{classes:"none"}},sidePagination:"server",cache:!1,height:500,striped:!0,pagination:!0,pageSize:10,pageList:[5,10,25,50,100,200],search:!0,showColumns:!0,showRefresh:!0,minimumCountColumns:2,clickToSelect:!1,maintainSelected:!0,columns:[{field:"itemId",title:"导航ID",align:"center",valign:"bottom",sortable:!0},{field:"itemName",title:"导航名称",align:"center",valign:"middle"},{field:"url",title:"地址",align:"left",valign:"top"},{field:"orderby",title:"优先级",align:"left",valign:"top",sortable:!0},{field:"createdAt",title:"创建时间",align:"left",valign:"top",formatter:d,sortable:!0},{field:"updatedAt",title:"更新时间",align:"left",valign:"top",formatter:d,sortable:!0},{field:"op",title:"操作",align:"center",valign:"middle",clickToSelect:!1,formatter:i}]}},e.addOrEdit="add",n("#navTable").on("click",".opBtn",function(a){var t=n(a.target).parent().attr("data-op"),r={itemId:n(a.target).parent().attr("data-itemId"),itemName:n(a.target).parent().attr("data-itemName"),url:n(a.target).parent().attr("data-url"),orderby:parseInt(n(a.target).parent().attr("data-orderby"))};"edit"===t?e.$apply(function(){e.showEdit(r)}):"delete"===t&&e.$apply(function(){e.showRemove(r)})}),e.showAdd=function(){e.addOrEdit="add",n("#addAndEditModal").modal("show")},e.showEdit=function(a){e.navId=a.itemId,e.addOrEdit="edit",e.navName=a.itemName,e.navUrl=a.url,e.navOrderBy=a.orderby,n("#addAndEditModal").modal("show")},e.showRemove=function(a){e.navId=a.itemId,n("#deleteModal").modal("show")},e.deleteNavBtn=function(){a({url:t.api+"/navbar/delete",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:n.param,data:{itemId:e.navId}}).then(function(a){"ok"===a.data.status&&(new r({type:"danger",text:"删除成功"}),e.navId=e.navName=e.navUrl=e.navOrderBy="",n("#deleteModal").modal("hide"),n("#navTable").bootstrapTable("refresh"))})},e.addAndEditNavBtn=function(){"edit"==e.addOrEdit?a({url:t.api+"/navbar/edit",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:n.param,data:{itemId:e.navId,itemName:e.navName,url:e.navUrl,orderby:e.navOrderBy}}).then(function(a){new r({type:"info",text:"修改成功"}),e.navId=e.navName=e.navUrl=e.navOrderBy="",n("#addAndEditModal").modal("hide"),n("#navTable").bootstrapTable("refresh")},function(e){new r({type:"error",text:"修改失败"})}):"add"==e.addOrEdit&&a({url:t.api+"/navbar/add",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:n.param,data:{itemName:e.navName,url:e.navUrl,orderby:e.navOrderBy}}).then(function(a){new r({type:"info",text:"添加成功"}),e.navName=e.navUrl=e.navOrderBy="",n("#addAndEditModal").modal("hide"),n("#navTable").bootstrapTable("refresh")},function(e){new r({type:"error",text:"添加失败"})})}}]}}});