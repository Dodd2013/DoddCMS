"use strict";define(["angular","pnotify"],function(e,t){t.prototype.options.styling="bootstrap3";var a="userRoleManageCtrl";return{route:{path:"userRoleManage",route:{url:"/userRoleManage",templateUrl:"tpls/userRoleManage.html",controller:a,params:{userName:{}}}},ctrl:{name:a,fn:["$scope","$state","$stateParams","$http",function(e,a,r,o){function l(e,t,a){if(null==e)return"未知时间";var r=new Date(e),o=r.toLocaleString();return o}function n(t,a,r){var o="",l="";return e.deleteUserRole&&(l="<a data-op='delete' data-DESC='"+a.DESC+"' data-roleName='"+a.roleName+"' data-roleId='"+a.roleId+"' class='opBtn' title='删除用户角色'><span class='glyphicon glyphicon-trash'></span></a>"),o+l}var d=r.userName;"string"!=typeof d?e.userName=!1:e.userName=d,e.premission=null,e.canAddUserRole=!0,e.editRole=e.deleteUserRoleBtn=!1,e.ajaxRequest=function(t){var a=o({url:config.api+"/userRole",method:"GET",withCredentials:!0,params:{params:t.data,userName:e.userName}});o({url:config.api+"/role",method:"GET",withCredentials:!0}).then(function(t){e.roleList=t.data.rows});null===e.premission?o({url:config.api+"/getPermission",method:"GET",withCredentials:!0,params:{functionModel:301}}).then(function(t){e.premission=t.data;var r=!0,o=!1,l=void 0;try{for(var n,d=e.premission[Symbol.iterator]();!(r=(n=d.next()).done);r=!0){var i=n.value;"addUserRole"===i.permissionName&&(e.canAddUserRole=!1),"deleteUserRole"===i.permissionName&&(e.deleteUserRole=!0)}}catch(s){o=!0,l=s}finally{try{!r&&d["return"]&&d["return"]()}finally{if(o)throw l}}return a}).then(function(e){t.success(e.data)}):a.then(function(e){t.success(e.data)})},e.tableCtrl={options:{toolbar:"#toolbar",ajax:e.ajaxRequest,rowStyle:function(e,t){return{classes:"none"}},sidePagination:"client",cache:!1,height:500,striped:!0,pagination:!0,pageSize:10,pageList:[5,10,25,50,100,200],search:!0,showColumns:!0,showRefresh:!0,minimumCountColumns:2,clickToSelect:!1,maintainSelected:!0,columns:[{field:"roleId",title:"角色ID",align:"center",valign:"bottom",sortable:!0},{field:"roleName",title:"角色名称",align:"center",valign:"middle"},{field:"DESC",title:"描述",align:"center",valign:"middle"},{field:"createdAt",title:"创建时间",align:"center",valign:"middle",formatter:l,sortable:!0},{field:"updatedAt",title:"更新时间",align:"center",valign:"middle",formatter:l,sortable:!0},{field:"op",title:"操作",align:"center",valign:"middle",clickToSelect:!1,formatter:n}]}},e.addOrEdit="add",$("#UserRoleTable").on("click",".opBtn",function(t){var a=$(t.target).parent().attr("data-op"),r={roleId:$(t.target).parent().attr("data-roleId"),roleName:$(t.target).parent().attr("data-roleName"),DESC:$(t.target).parent().attr("data-DESC")};"delete"===a&&e.$apply(function(){e.showRemove(r)})}),e.showAdd=function(){e.addOrEdit="add",$("#addAndEditModal").modal("show")},e.showRemove=function(t){e.roleId=t.roleId,$("#deleteModal").modal("show")},e.deleteUserRoleBtn=function(){o({url:config.api+"/userRole/delete",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:$.param,data:{roleId:e.roleId,userName:e.userName}}).then(function(a){"ok"===a.data.status&&(new t({type:"danger",text:"删除成功"}),e.roleId=e.roleName=e.DESC="",$("#deleteModal").modal("hide"),$("#UserRoleTable").bootstrapTable("refresh")),"no"===a.data.status&&(new t({type:"danger",text:"删除失败！"}),e.roleId=e.roleName=e.DESC="",$("#deleteModal").modal("hide"),$("#UserRoleTable").bootstrapTable("refresh"))})},e.datax={},e.addAndEditRoleBtn=function(){"add"==e.addOrEdit&&o({url:config.api+"/userRole/add",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:$.param,data:{roleId:e.datax.selectRole.roleId,userName:e.userName}}).then(function(a){new t({type:"info",text:"添加成功"}),e.roleId=e.roleName=e.DESC="",$("#addAndEditModal").modal("hide"),$("#UserRoleTable").bootstrapTable("refresh")},function(e){new t({type:"error",text:"添加失败"})})}}]}}});