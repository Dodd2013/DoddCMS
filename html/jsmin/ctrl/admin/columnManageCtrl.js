"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}define(["angular","jquery","jstree","ngJsTree","config","pnotify"],function(e,t,n,o,r,a){a.prototype.options.styling="bootstrap3";var l="columnManageCtrl";return r=r.config,{route:{path:"columnManage",route:{url:"/columnManage",templateUrl:"tpls/columnManage.html",controller:l}},ctrl:{name:l,fn:["$scope","$timeout","$http",function(n,o,l){n.columnName="",n.DESC="",n.initJsTree=function(){l({url:r.api+"/column",method:"GET",withCredentials:!0}).then(function(e){n.originalData=e.data,n.reCreateTree()})},n.onIndexPage=!0,n.isRoot=!1,n.createNewColumn=function(){"#"!==n.parentColumnId&&"root"!=n.selected.type?new a({type:"warning",text:"子栏目不允许有二级子栏目!"}):"#"!==n.parentColumnId&&n.isRoot===!0?new a({type:"warning",text:"不允许有二级根栏目!"}):""===n.columnName||""===n.DESC?new a({type:"warning",text:"栏目名称或者栏目描述不能为空!"}):l({url:r.api+"/column/add",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:t.param,data:_defineProperty({parentColumnId:n.parentColumnId,type:n.type,columnName:n.columnName,DESC:n.DESC,onIndexPage:n.onIndexPage},"type",n.isRoot?"root":"")}).then(function(e){new a({type:"success",text:"添加栏目成功!"}),n.initJsTree()},function(){new a({type:"error",text:"添加栏目失败!"})})},n.editColumn=function(){"#"!==n.selectParentColumnId&&n.selectIsRoot===!0?new a({type:"warning",text:"不允许有二级根栏目!"}):l({url:r.api+"/column/edit",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:t.param,data:{columnId:n.selected.id,columnName:n.selectedcolumnName,DESC:n.selectedDESC,onIndexPage:n.selectedOnIndexPage,type:n.selectIsRoot?"root":""}}).then(function(e){new a({type:"success",text:"修改栏目成功!"}),n.initJsTree()},function(){new a({type:"error",text:"修改栏目失败!"})})},n.deleteColumn=function(){l({url:r.api+"/column/delete",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:t.param,data:{columnId:n.selected.id}}).then(function(e){new a({type:"success",text:"删除栏目成功!"}),n.initJsTree(),t("#deleteColumnModal").modal("hide")},function(){new a({type:"error",text:"删除栏目失败!"})})},n.selectRootColumn=function(){n.parentColumnName="顶级父节点",n.parentColumnId="#",n.selected.type=n.type="root",n.treeInstance.jstree(!0).deselect_all()},n.selectColumn=function(e,t,o){for(var r in n.originalData)if(n.originalData[r].id===t.selected[0]){n.selected=n.originalData[r];break}n.selectIsRoot="root"===n.selected.type,n.selectedcolumnName=n.parentColumnName=n.selected.text,n.parentColumnId=n.selected.id,n.selectedDESC=n.selected.DESC,n.selectParentColumnId=n.selected.parentColumnId,n.selectedOnIndexPage=n.selected.onIndexPage,n.type=null},n.treeEventsObj={select_node:n.selectColumn},n.ignoreChanges=!1,n.treeInstance={},n.originalData=[],n.treeData=[],e.copy(n.originalData,n.treeData),n.treeConfig={core:{multiple:!1,animation:!0,error:function(t){$log.error("treeCtrl: error from js tree - "+e.toJson(t))},check_callback:!0,worker:!0},types:{"default":{icon:"glyphicon glyphicon-th"},root:{icon:"glyphicon glyphicon-th-large"}},version:1,plugins:["types","contextmenu"]},n.reCreateTree=function(){n.ignoreChanges=!0,e.copy(n.originalData,n.treeData),n.treeConfig.version++},n.applyModelChanges=function(){return!n.ignoreChanges},n.initJsTree()}]}}});