"use strict";define(["angular"],function(t){var e="contentManageCtrl";return{route:{path:"contentManage",route:{url:"/contentManage",templateUrl:"tpls/contentManage.html",controller:e}},ctrl:{name:e,fn:["$scope","$http",function(t,e){function a(t,e,a){if(null==t)return"未知时间";var n=new Date(t),r=n.toLocaleString();return r}function n(e,a,n){var r="",i="",o=!0,l=!1,d=void 0;try{for(var c,s=t.premission[Symbol.iterator]();!(o=(c=s.next()).done);o=!0){var u=c.value;"addNavBar"===u.permissionName&&(t.canAddNav=!1),"editNavBar"===u.permissionName&&(r="<a data-op='edit' data-orderby='"+a.orderby+"' data-url='"+a.url+"' data-itemName='"+a.itemName+"' data-itemId='"+a.itemId+"' class='opBtn' title='编辑导航'><span class='glyphicon glyphicon-edit'></span></a>"),"deleteNavBar"===u.permissionName&&(i="<a data-op='delete' data-orderby='"+a.orderby+"' data-url='"+a.url+"' data-itemName='"+a.itemName+"' data-itemId='"+a.itemId+"' class='opBtn' title='删除导航'><span class='glyphicon glyphicon-trash'></span></a>")}}catch(m){l=!0,d=m}finally{try{!o&&s["return"]&&s["return"]()}finally{if(l)throw d}}return r+i}t.premission=null,t.ajaxRequest=function(a){var n=e({url:config.api+"/content",method:"GET",withCredentials:!0,params:a.data});null===t.premission?e({url:config.api+"/content/getPermission",method:"GET",withCredentials:!0}).then(function(e){return t.premission=e.data,n}).then(function(t){a.success(t.data)}):n.then(function(t){a.success(t.data)})},t.tableCtrl={options:{toolbar:"#toolbar",ajax:t.ajaxRequest,rowStyle:function(t,e){return{classes:"none"}},sidePagination:"server",cache:!1,height:500,striped:!0,pagination:!0,pageSize:10,pageList:[5,10,25,50,100,200],search:!0,showColumns:!0,showRefresh:!0,minimumCountColumns:2,clickToSelect:!1,maintainSelected:!0,columns:[{field:"itemId",title:"导航ID",align:"center",valign:"bottom",sortable:!0},{field:"itemName",title:"导航名称",align:"center",valign:"middle"},{field:"url",title:"地址",align:"left",valign:"top"},{field:"orderby",title:"优先级",align:"left",valign:"top",sortable:!0},{field:"createdAt",title:"创建时间",align:"left",valign:"top",formatter:a,sortable:!0},{field:"updatedAt",title:"更新时间",align:"left",valign:"top",formatter:a,sortable:!0},{field:"op",title:"操作",align:"center",valign:"middle",clickToSelect:!1,formatter:n}]}},t.addOrEdit="add",$("#navTable").on("click",".opBtn",function(e){var a=$(e.currentTarget).attr("data-op"),n={contentId:$(e.currentTarget).attr("data-itemId"),contentTitle:$(e.currentTarget).attr("data-itemName"),url:$(e.currentTarget).attr("data-url"),orderby:parseInt($(e.currentTarget).attr("data-orderby"))};"edit"===a?t.$apply(function(){t.showEdit(n)}):"delete"===a&&t.$apply(function(){t.showRemove(n)})}),t.showEdit=function(t){},t.showRemove=function(e){t.contentId=e.contentId,$("#deleteModal").modal("show")},t.deleteContentBtn=function(){e({url:config.api+"/content/delete",method:"POST",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"*/*"},transformRequest:$.param,data:{contentId:t.contentId}}).then(function(t){"ok"===t.data.status&&(new PNotify({type:"danger",text:"删除成功"}),$("#deleteModal").modal("hide"),$("#contentIdTable").bootstrapTable("refresh"))})}}]}}});